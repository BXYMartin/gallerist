#!/usr/bin/env ruby
#
# This code is free software; you can redistribute it and/or modify it under
# the terms of the new BSD License.
#
# Copyright (c) 2015, Sebastian Staudt

require 'bundler/setup'
require 'rack'

$LOAD_PATH << File.join(__dir__, '..', 'lib')

require 'gallerist'

config_path = File.expand_path File.join(__dir__, '..', 'config.ru')

ENV['GALLERIST_LIBRARY'] = ARGV[0]
ENV['RACK_ENV'] ||= 'production'

begin
  Rack::Server.start config: config_path, server: :unicorn, worker_processes: 4
rescue Gallerist::LibraryInUseError
  $stderr.puts 'The library is currently in use.' <<
               ' Is it currently opened in Photos?'
end
